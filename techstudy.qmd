---
title: "Mapping -> Technoledgy"
---

```{r}
#| echo: false
#| message: false
library(tidycensus)
library(ggplot2)
library(tidyverse)
library(tigris)
library(sf)
library(dplyr)
library(readr)

# census_api_key("a310026cfc25bf81421c3505e3f2862d3c711e99", install = FALSE)

# 2) Explore variables
# vars <- load_variables(2023, "acs5", cache = TRUE)
# View a few example codes
# vars |> dplyr::filter(grepl("^B28", name)) |> dplyr::slice_head(n = 10)

# 3) Parameters (EDIT ME)
state_abbr <- "CA"
geo_level  <- "county"   # options: state, county, tract, block group
my_vars    <- c(Device = "B28010_001", MedianHHI = "B19019_001")
year_acs   <- 2023
survey     <- "acs5"

# 4) Download
acs <- get_acs(
  geography = geo_level,
  variables = my_vars,
  state = state_abbr,
  year = year_acs,
  survey = survey,
  geometry = TRUE,
  progress_bar = FALSE
)

# 5) Wide format for convenience
acs_wide <- acs |>
  tidyr::pivot_wider(
    id_cols = c(GEOID, NAME, geometry),
    names_from = variable,
    values_from = c(estimate, moe)
  )

# 6) Map (edit titles/theme)
ggplot(acs_wide) +
  geom_sf(aes(fill = estimate_Device), color = NA) +
  scale_fill_viridis_c(name = "Types of Computers in Household", option = "plasma") +
  labs(title = paste0("ACS ", year_acs, " 5-year: Tech Aggregation â€” ", state_abbr, " (", geo_level, ")"),
       caption = "Source: U.S. Census Bureau via tidycensus") +
  theme_minimal()

# 7) Table (top/bottom by poverty count)
top10 <- acs_wide |>
  arrange(desc(estimate_MedianHHI)) |>
  select(NAME, estimate_MedianHHI, moe_MedianHHI) |>
  slice_head(n = 10)
print(top10)
bottom10 <- acs_wide |>
  arrange(estimate_MedianHHI) |>
  select(NAME, estimate_MedianHHI, moe_MedianHHI) |>
  slice_head(n = 10)
print(bottom10)
```